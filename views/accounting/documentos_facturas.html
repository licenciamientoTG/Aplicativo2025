{% extends "views/layouts/base.html" %}
{% block title %}Facturas - Documentos{% endblock %}
{% block mycss %}
<style>
    .loading {
        opacity: 0.5;
        pointer-events: none;
        position: relative;
    }
    .loading::after {
        content: 'Cargando...';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.5rem;
        font-weight: bold;
        color: #0d6efd;
    }
    .badge-compra {
        background-color: #0dcaf0;
        color: #000;
    }
    .badge-venta {
        background-color: #198754;
    }
</style>
{% endblock %}
{% block menutitle %}Facturas de Documentos{% endblock %}
{% block content %}

<div class="container-fluid p-0">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Filtros de Búsqueda</h5>
                </div>
                <div class="card-body">
                    <form id="form-filtros-facturas">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="from" class="form-label">Fecha Inicio:</label>
                                <input type="date" class="form-control" name="from" id="from"
                                       value="{{ first_date }}" required>
                            </div>
                            <div class="col-md-3">
                                <label for="until" class="form-label">Fecha Fin:</label>
                                <input type="date" class="form-control" name="until" id="until"
                                       value="{{ last_date }}" required>
                            </div>
                            <div class="col-md-3">
                                <label for="codgas" class="form-label">Estación (Opcional):</label>
                                <select class="form-select" name="codgas" id="codgas">
                                    <option value="">Todas las estaciones</option>
                                    {% if estaciones %}
                                        {% for estacion in estaciones %}
                                            <option value="{{ estacion.Codigo }}">{{ estacion.Nombre }}</option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <button type="button" id="btn-buscar-facturas" class="btn btn-primary w-100">
                                    <i data-feather="search"></i> Buscar Facturas
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Listado de Facturas</h5>
                    <button type="button" id="btn-export-excel" class="btn btn-success btn-sm">
                        <i data-feather="download"></i> Exportar a Excel
                    </button>
                </div>
                <div class="card-body">
                    <div id="alert-container" class="mb-3"></div>
                    <div class="table-responsive">
                        <table class="table table-hover table-striped table-sm w-100" id="documentos_facturas_table">
                            <thead class="table-dark">
                                <tr>
                                    <th>Número</th>
                                    <th>Factura</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Estación</th>
                                    <th>Tipo</th>
                                    <th>Entidad</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th>IVA</th>
                                    <th>IEPS</th>
                                    <th>Total</th>
                                    <th>UUID</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th>Número</th>
                                    <th>Factura</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Estación</th>
                                    <th>Tipo</th>
                                    <th>Entidad</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th>IVA</th>
                                    <th>IEPS</th>
                                    <th>Total</th>
                                    <th>UUID</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block myjs %}
<script src="{{ JS }}accounting.js"></script>
<script>
$(document).ready(function() {
    // Inicializar Feather Icons
    if (typeof feather !== 'undefined') {
        feather.replace();
    }

    let documentosTable = null;

    // Función para mostrar alertas
    

   

    // Evento del botón buscar
    $('#btn-buscar-facturas').on('click', function() {
        initializeDataTable();
    });

    // Evento del botón exportar (usando la funcionalidad de DataTables)
    $('#btn-export-excel').on('click', function() {
        if (documentosTable) {
            documentosTable.button('.buttons-excel').trigger();
        } else {
            showAlert('Primero debe buscar facturas', 'warning');
        }
    });

    // Cargar datos automáticamente al inici
    // initializeDataTable();
});
</script>
{% endblock %}
