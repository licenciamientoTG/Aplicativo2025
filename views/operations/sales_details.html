{% extends "views/layouts/base.html" %}
{% block title %}Operaciones{% endblock %}
{% block mycss %}{% endblock %}
{% block menutitle %}Detalles de ventas{% endblock %}
{% block content %}

<div class="row">
    <div class="col-12">
        <div class="card table-responsive">
            <div class="card-header pb-0">
                <div class="card-actions float-end">
                    <div class="dropdown position-relative">
                        <a href="#" data-bs-toggle="dropdown" data-bs-display="static">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal align-middle">
                                <circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle>
                            </svg>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="javascript:void(0);" id="exportExcel"><i data-feather="file-text"></i> Exportar a Excel</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-striped table-sm w-100" style="font-size: medium;" id="sales_details_table">
                    <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Estación</th>
                        <th>Producto</th>
                        <th>Volumen</th>
                        <th>Precio</th>
                        <th>Importe</th>
                        <th>Tipo</th>
                    </tr>
                    </thead>
                    <tbody>
<!--                     Vamos a agregar un freach de twig php-->
                    {% for sale in despachos %}
                    <tr>
                        <td>{{ sale.Fecha }}</td>
                        <td>{{ sale.Gasolinera }}</td>
                        <td>{{ sale.Producto }}</td>
                        <td>{{ sale.Volumen | number_format(3,'.',',') }} lts</td>
                        <td>$ {{ sale.Precio | number_format(2,'.',',') }}</td>
                        <td>$ {{ sale.Importe | number_format(2,'.',',') }}</td>
                        <td>{{ sale.Tipo }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th>Fecha</th>
                        <th>Estación</th>
                        <th>Producto</th>
                        <th>Volumen</th>
                        <th>Precio</th>
                        <th>Importe</th>
                        <th>Tipo</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block myjs %}
<script src="{{ JS }}operations.js"></script>
<script>
<!--    Vamos a convertir nuestra tabla en Datatable -->
    $(document).ready(function() {
        $('#sales_details_table').DataTable({
            order: [[ 0, "desc" ]],
            paging: true,
            lengthChange: true,
            searching: true,
            ordering: true,
            info: true,
            autoWidth: true,
            responsive: true,
            pageLength: 50, // Establece el número de filas por página en 50
            buttons: [
                {
                    extend: 'excel',
                    text: 'Exportar a Excel',
                    className: 'btn btn-success',
                    filename: 'Ventas',
                    exportOptions: {
                        modifier: {
                            page: 'all'
                        }
                    }
                }
            ]
        });
    });
    $(document).on('click', '#exportExcel', function() {
        $('#sales_details_table').DataTable().button(0).trigger();
    });
</script>
{% endblock %}