<div class="row">
    <div class="col-4">
        <div class="card shadow m-1">
            <div class="card-body table-responsive">
                <h5 class="card-title">Formas de pago - {{ data[0].Isla }}</h5>
                <table class="table table-sm table-striped table-hover table-payments tableModal1 dataTable" style="font-size: x-small" id="DataTables_Table_4" role="grid">
                    <thead>
                    <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="DataTables_Table_4" rowspan="1" colspan="1" aria-sort="ascending" aria-label="FORMA PAGO: activate to sort column descending" style="width: 137.883px;">FORMA PAGO</th><th class="sorting" tabindex="0" aria-controls="DataTables_Table_4" rowspan="1" colspan="1" aria-label="MONTO: activate to sort column ascending" style="width: 71.7913px;">MONTO</th></tr>
                    </thead>
                    <tbody>
                    {% set total_amounts = 0 %}
                    {% for row in data %}
                    {% set total_amounts = (total_amounts + row.Total) %}
                    <tr>
                        <td class="text-nowrap">{{ row.ValorDescripcion }}</td>
                        <td class="text-nowrap">$ {{ row.Total | number_format(2) }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th class="text-end">TOTAL</th>
                        <th class="text-nowrap">$ {{ total_amounts | number_format(2) }}</th>
                    </tr>
                    <tr>
                        <th class="text-end">Dif. Contado x Acreditar</th>
                        <th class="text-nowrap diff"></th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    <div class="col-8">
        <div class="card shadow m-1">
            <div class="card-body table-responsive">
                <h5 class="card-title">Ventas totales - {{ data[0].Isla }}</h5>
                <table class="table table-sm table-striped table-hover table-values tableModal2" style="font-size: x-small">
                    <thead>
                    <tr>
                        <th>BOMBA</th>
                        <th>PRODUCTO</th>
                        <th>INICIAL</th>
                        <th>FINAL</th>
                        <th>VENDIDO</th>
                        <th>IMPORTE</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Vamos a crear una variable llamada total para totalizar en el footer -->
                    {% set total = 0 %}
                    {% for row in readings %}
                    <!-- Vamos a crear una variable llamada total para totalizar en el footer -->
                    {% set total = total + row.finalAmount %}
                    <tr>
                        <td class="text-nowrap">{{ row.nrobom }}</td>
                        <td class="text-nowrap">{{ row.Producto }}</td>
                        <td class="text-nowrap">{{ row.initialElectronicReading | number_format(3) }}</td>
                        <td class="text-nowrap">{{ (row.initialElectronicReading + row.finalElectronicReading) | number_format(3) }}</td>
                        <td class="text-nowrap">{{ row.finalElectronicReading | number_format(3) }}</td>
                        <td class="text-nowrap">$ {{ row.finalAmount | number_format(2) }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="5" class="text-end">TOTAL</th>
                        <th class="text-nowrap">$ {{ total | number_format(2) }}</th>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
<input type="hidden" name="totalFormasPago" id="totalFormasPago" value="{{ total_amounts }}">
<input type="hidden" name="totalVentasLecturas" id="totalVentasLecturas" value="{{ total }}">

<script>
    $(document).ready(function() {
        var totalFormasPago = parseFloat($('#totalFormasPago').val());
        var totalVentasLecturas = parseFloat($('#totalVentasLecturas').val());
        var diff = totalFormasPago - totalVentasLecturas;
        $('.diff').text('$ ' + diff.toFixed(2));

        // Vamos a pintar de otro color la diferencia
        if (diff < 0) {
            $('.diff').css('color', 'red');
        } else {
            $('.diff').css('color', 'green');
        }
    });
</script>
